<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Organizer Profile</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

  <!-- Custom CSS -->
  <link rel="stylesheet" href="Styling/profileOrganizer.css">
</head>

<body>
  <!-- ================= NAVBAR ================= -->
  <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
    <div class="container">
      <a class="navbar-brand fw-bold d-flex align-items-center" href="index.html">
        <img src="dashboardpics/Ansg.jpg" alt="Logo" width="40" height="40" class="rounded-circle me-2">
        AnshSports
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item"><a class="nav-link active" href="DashOrganizer.html">Dashboard</a></li>
          <li class="nav-item"><a class="nav-link active" href="profileOrganizer.html"> Organizer Profile</a></li>
          <li class="nav-item"><a class="nav-link" href="publish-tournaments.html">Post Events</a></li>
          
          <li class="nav-item">
            <button class="btn btn-light text-dark ms-2" onclick="location.href='logout.html'">Logout</button>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- ================= PAGE CONTENT ================= -->
  <div class="container mt-5 pt-4">
    <div class="card shadow p-4 profile-card">
      <h2 class="mb-4">Organizer Profile</h2>
      <form method="post" class="row g-3" enctype="multipart/form-data">
        
        <!-- Email -->
        <div class="col-md-6">
          <label class="form-label">Email</label>
          <div class="input-group">
            <input type="email" name="txtMail" id="txtMail" class="form-control">
            <button class="btn btn-outline-primary" type="button" id="btnFetch">Search</button>
          </div>
        </div>

        <!-- Org & Contact -->
        <div class="col-md-6">
          <label class="form-label">Organization</label>
          <input type="text" class="form-control" name="org" id="org">
        </div>
        <div class="col-md-6">
          <label class="form-label">Contact Number</label>
          <input type="text" class="form-control" name="contact" id="contact">
        </div>

        <!-- Address & City -->
        <div class="col-md-6">
          <label class="form-label">Address</label>
          <input type="text" name="address" class="form-control" id="Address">
        </div>
        <div class="col-md-6">
          <label class="form-label">City</label>
          <input type="text" name="city" class="form-control" id="City">
        </div>

        <!-- ID Proof & Pic -->
        <div class="col-md-6">
          <label class="form-label">ID Proof</label>
          <select id="Idproof" name="id" class="form-select">
            <option selected>Select</option>
            <option id="rc" value="RegCert">Registration Certificate</option>
            <option id="ad" value="Adhaar">Adhaar Card</option>
          </select>
        </div>
        <div class="col-md-6">
          <label class="form-label">Picture Upload</label>
          <input type="file" id="pic" name="profilepic" class="form-control" onchange="preview();">
          <img src="" id="frame" width="120" height="120" alt="Preview" class="mt-2 rounded shadow">
        </div>

        <!-- Sports & Previous Tournaments -->
        <div class="col-md-6">
          <label class="form-label">Sports Organized</label>
          <select class="form-select" name="deal" id="sports" size="4" multiple>
            <option>Cricket</option>
            <option>Basketball</option>
            <option>Badminton</option>
            <option>Hockey</option>
            <option>Kabaddi</option>
            <option>Soccer</option>
            <option>Javelin Throw</option>
          </select>
        </div>
        <div class="col-md-6">
          <label class="form-label">Previous Tournaments Hosted</label>
          <textarea class="form-control" name="prev" id="prev" rows="3"></textarea>
        </div>

        <!-- Website & Insta -->
        <div class="col-md-6">
          <label class="form-label">Website</label>
          <input type="text" class="form-control" name="website" id="Website">
        </div>
        <div class="col-md-6">
          <label class="form-label">Instagram</label>
          <input type="text" class="form-control" name="insta" id="Insta">
        </div>

        <!-- Buttons -->
        <!-- Buttons -->
<div class="col-12 text-center">
  <button class="btn btn-gradient mx-2 px-4" type="submit" formaction="/save">Save</button>
  <button class="btn btn-gradient mx-2 px-4" type="button" id="btnUpdate">Update</button>
</div>

      </form>
    </div>
  </div>

  <!-- ================= FOOTER ================= -->
  <footer class="text-white text-center py-3 mt-5">
    <p>© 2025 AnshSports | All Rights Reserved</p>
    <p class="mb-1">"Great tournaments begin with great organizers – thank you for empowering sports!"</p>
    <div>
      <a href="#" class="text-white me-2"> Manage Events</a>
      <a href="#" class="text-white me-2"> Reports</a>
      <a href="#" class="text-white"> Support</a>
    </div>
  </footer>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Script for Image Preview -->
  <script>

    
    function preview() {
      const frame = document.getElementById("frame");
      const file = document.getElementById("pic").files[0];
      if (file) frame.src = URL.createObjectURL(file);
    }

    $(document).ready(function () {

      // Check if user is logged in
        if(localStorage.getItem("activeUser")==null)
      {
        location.href="index.html";
        return;
      }
      else{
        alert(localStorage.getItem("activeUser"));
        $("#txtmail").val(localStorage.getItem("activeUser")).attr("disabled",true);
      }


      // Fetch and populate profile data
      $("#btnFetch").click(function () {
        let email = $("#txtMail").val();
        $.ajax({
          type: "get",
          url: "/search-user",
          data: { txtMail: email }
        })
          .done(function (responseAry) {
            if (responseAry.length == 0) {
              alert("No Data Found!");
              return;
            }

            // Basic fields
            $("#org").val(responseAry[0].organization);
            $("#contact").val(responseAry[0].contact);
            $("#Address").val(responseAry[0].address);
            $("#City").val(responseAry[0].city);

            // ID Proof
            if (responseAry[0].id == "rc") $("#rc").prop("selected", true); 
            else $("#ad").prop("selected", true);

            // Picture
            $("#frame").prop("src", responseAry[0].ppic);

            // Sports (array expected, e.g. ["Cricket","Soccer"])
            // $("#sports option").prop("selected", false); // reset
            if (responseAry[0].sports) {
              $("#sports").val(responseAry[0].sports.split(","));
            }
            

            // Previous tournaments
            $("#prev").val(responseAry[0].prev || "");

            // Website & Instagram
            $("#Website").val(responseAry[0].website || "");
            $("#Insta").val(responseAry[0].insta || "");
          })
          .fail(function (err) {
            alert("Error: " + err);
          });
      });

      // Update profile data
          // ================= UPDATE BUTTON AJAX =================
    $("#btnUpdate").click(function () {
      let form = $("form")[0];
      let formData = new FormData(form);

      $.ajax({
        type: "post",
        url: "/update", // backend route
        data: formData,
        processData: false,
        contentType: false
      })
      .done(function (res) {
        alert("Profile updated successfully!");
      })
      .fail(function (err) {
        alert("Error updating profile: " + err.responseText);
      });
    });

    });
  </script>
</body>
</html>
